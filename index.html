<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POKER On Jack Tall Back - Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #021a03;
            --bg-row: #062e08;
            --accent-yellow: #ca8a04;
        }

        body {
            font-family: 'Roboto Condensed', sans-serif;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at center, #0a4f0d 0%, #021a03 100%);
            overflow-x: hidden;
        }

        h1, h2, h3, button, th {
            font-family: 'Oswald', sans-serif;
        }

        .modal-overlay {
            transition: opacity 0.3s ease;
        }

        /* --- STYLES PARA CHIPS --- */
        .chip-label { display: inline-flex; align-items: center; justify-content: center; cursor: pointer; }
        .chip-checkbox { appearance: none; -webkit-appearance: none; position: absolute; opacity: 0; }
        .chip { height: 28px; width: 28px; border-radius: 50%; background-color: #374151; border: 2px solid #6b7280; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease-in-out; box-shadow: 0 2px 4px rgba(0,0,0,0.4), inset 0 2px 2px rgba(255,255,255,0.1); position: relative; }
        .chip::before { content: ''; position: absolute; height: 18px; width: 18px; border-radius: 50%; border: 1px dashed #9ca3af; }
        .buy-in-cb + .chip { background-color: #1e40af; border-color: #60a5fa; }
        .rebuy-cb + .chip { background-color: #991b1b; border-color: #f87171; }
        .add-on-cb + .chip { background-color: #166534; border-color: #4ade80; }
        .chip-checkbox:checked + .chip { transform: scale(1.15); box-shadow: 0 0 12px 2px var(--glow-color, #f7fafc), 0 4px 6px rgba(0,0,0,0.5); border-color: #fff; z-index: 5; }
        .buy-in-cb:checked + .chip { --glow-color: #3b82f6; }
        .rebuy-cb:checked + .chip { --glow-color: #ef4444; }
        .add-on-cb:checked + .chip { --glow-color: #22c55e; }
        .chip-checkbox:checked + .chip::before { border: 2px solid #fff; }
        .player-row.eliminated { background-color: rgba(20, 20, 20, 0.8) !important; }
        .player-row.eliminated .player-name { text-decoration: line-through; color: #6b7280; }
        .player-row.eliminated .chip, .player-row.eliminated .chip-checkbox { opacity: 0.3; pointer-events: none; }
        .elimination-rank { font-size: 0.75rem; font-weight: bold; color: #f59e0b; background-color: rgba(0,0,0,0.5); border-radius: 50%; width: 22px; height: 22px; display: inline-flex; align-items: center; justify-content: center; margin-right: 8px; border: 1px solid #ca8a04; }
        .rebuys-disabled .rebuy-cb, .rebuys-disabled .add-on-cb { pointer-events: none; }
        .rebuys-disabled .rebuy-cb + .chip, .rebuys-disabled .add-on-cb + .chip { cursor: not-allowed; background-color: #374151 !important; border-color: #4b5563 !important; opacity: 0.4; }
        
        /* Sticky Columns */
        .table-container { overflow-x: auto; position: relative; }
        .sticky-left { position: sticky; left: 0; z-index: 20; background-color: var(--bg-row); border-right: 2px solid rgba(202, 138, 4, 0.3); box-shadow: 2px 0 5px rgba(0,0,0,0.3); }
        .sticky-right { position: sticky; right: 0; z-index: 20; background-color: var(--bg-row); border-left: 2px solid rgba(202, 138, 4, 0.3); box-shadow: -2px 0 5px rgba(0,0,0,0.3); }
        thead th.sticky-left, thead th.sticky-right { background-color: #000; z-index: 30; }
        @media (max-width: 640px) { .chip { height: 24px; width: 24px; } .chip::before { height: 16px; width: 16px; } .sticky-right { border-left: none; box-shadow: none; } }
    </style>
</head>
<body class="text-gray-200 min-h-screen pb-10">

    <div id="toast-container" class="fixed bottom-4 right-4 z-[100] flex flex-col gap-2 pointer-events-none"></div>

    <div id="main-content" class="container mx-auto p-2 sm:p-4 lg:p-6 max-w-7xl">
        
        <header class="relative text-center mb-6 pt-2">
            <button id="mute-btn" class="absolute top-0 left-0 bg-gray-800 hover:bg-gray-700 text-white p-3 rounded-full shadow-lg border border-gray-600 transition-all hover:scale-105" title="Ativar/Desativar Som">
                <svg id="sound-on-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"><path d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"/><path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.482 5.482 0 0 1 11.025 8a5.482 5.482 0 0 1-1.61 3.89l.706.706z"/><path d="M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"/></svg>
                <svg id="sound-off-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="hidden text-red-400" viewBox="0 0 16 16"><path d="M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06zm7.137 2.096a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0z"/></svg>
            </button>
            <h1 class="text-4xl sm:text-6xl font-bold text-white tracking-widest uppercase drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)]">
                <span class="text-red-600">‚ô¶</span> JACK TALL BACK <span class="text-red-600">‚ô•</span>
            </h1>
            <p class="text-yellow-500/80 mt-1 text-sm sm:text-base font-mono uppercase tracking-widest">Tournament Manager</p>
            <div class="absolute top-0 right-0">
                <button id="admin-login-btn" class="bg-blue-700 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded shadow border border-blue-400 text-xs uppercase transition-colors">Admin</button>
                <button id="logout-btn" class="bg-red-700 hover:bg-red-600 text-white font-bold py-1 px-3 rounded shadow border border-red-400 text-xs uppercase hidden transition-colors">Sair</button>
            </div>
        </header>

        <div id="blinds-timer-section" class="mb-6 bg-gradient-to-b from-gray-900/90 to-black/90 backdrop-blur-md rounded-2xl shadow-2xl p-4 sm:p-6 border border-yellow-600/30 ring-1 ring-yellow-500/10">
            <h2 class="text-lg font-bold text-yellow-500 uppercase tracking-widest text-center mb-1 flex justify-center items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span> AO VIVO <span id="level-indicator" class="text-white ml-2"></span>
            </h2>
            <div id="blinds-note" class="text-center text-yellow-200/80 text-sm h-5 font-medium mb-2"></div>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 items-center text-center">
                <div class="sm:text-left order-2 sm:order-1 bg-black/40 p-3 rounded-lg sm:bg-transparent">
                    <p class="text-xs text-gray-400 uppercase tracking-wide mb-1">Blinds Atuais</p>
                    <p id="current-blinds" class="text-3xl sm:text-4xl font-bold text-white tracking-tighter">--/--</p>
                </div>
                <div class="order-1 sm:order-2 font-mono text-7xl sm:text-8xl text-yellow-400 font-bold flex items-center justify-center gap-4 relative py-2">
                    <button id="prev-level-btn" class="absolute left-0 sm:-left-4 text-2xl text-gray-600 hover:text-white transition-colors p-2">&lt;</button>
                    <span id="timer-display" class="tabular-nums drop-shadow-[0_0_15px_rgba(234,179,8,0.3)]">--:--</span>
                    <button id="next-level-btn" class="absolute right-0 sm:-right-4 text-2xl text-gray-600 hover:text-white transition-colors p-2">&gt;</button>
                </div>
                <div class="sm:text-right order-3 bg-black/40 p-3 rounded-lg sm:bg-transparent">
                    <p class="text-xs text-gray-400 uppercase tracking-wide mb-1">Pr√≥ximo N√≠vel</p>
                    <p id="next-blinds" class="text-xl sm:text-2xl font-bold text-gray-300">--/--</p>
                </div>
            </div>
            <div class="mt-6 flex flex-wrap justify-center items-center gap-3 bg-black/20 p-2 rounded-lg inline-flex mx-auto w-full">
                <div class="flex items-center gap-2 px-3 py-1 bg-gray-800/50 rounded border border-gray-700">
                    <label for="level-duration" class="text-xs text-gray-400 uppercase">Minutos:</label>
                    <input type="number" id="level-duration" value="15" class="w-12 bg-transparent text-white text-center font-bold outline-none focus:text-yellow-400">
                </div>
                <button id="timer-control-btn" class="flex-1 sm:flex-none bg-green-700 hover:bg-green-600 text-white font-bold py-2 px-6 rounded shadow border-b-4 border-green-900 active:border-b-0 active:translate-y-1 transition-all uppercase text-sm tracking-wide">INICIAR</button>
                <button id="reset-timer-btn" class="flex-1 sm:flex-none bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded shadow border-b-4 border-gray-900 active:border-b-0 active:translate-y-1 transition-all uppercase text-sm tracking-wide">RESET TIMER</button>
            </div>
        </div>
        
        <div id="summary-panel" class="mb-8 grid grid-cols-2 lg:grid-cols-4 gap-3 text-center">
            <div class="bg-black/40 backdrop-blur rounded-xl border border-gray-700 p-3 flex flex-col justify-center">
                <h3 class="text-[10px] sm:text-xs font-bold text-gray-400 uppercase tracking-widest">Jogadores</h3>
                <p id="total-players-summary" class="text-2xl sm:text-3xl font-bold text-white">0</p>
            </div>
            <div class="bg-black/40 backdrop-blur rounded-xl border border-blue-900/50 p-3 flex flex-col justify-center relative overflow-hidden">
                <div class="absolute top-0 right-0 w-8 h-8 bg-blue-500/10 rounded-bl-full"></div>
                <h3 class="text-[10px] sm:text-xs font-bold text-blue-400 uppercase tracking-widest">Buy-ins</h3>
                <p id="total-buyins-summary" class="text-2xl sm:text-3xl font-bold text-white">0</p>
            </div>
            <div class="bg-black/40 backdrop-blur rounded-xl border border-red-900/50 p-3 flex flex-col justify-center relative overflow-hidden">
                <div class="absolute top-0 right-0 w-8 h-8 bg-red-500/10 rounded-bl-full"></div>
                <h3 class="text-[10px] sm:text-xs font-bold text-red-400 uppercase tracking-widest">Rebuys</h3>
                <p id="total-rebuys-summary" class="text-2xl sm:text-3xl font-bold text-white">0</p>
            </div>
            <div class="bg-black/40 backdrop-blur rounded-xl border border-green-900/50 p-3 flex flex-col justify-center relative overflow-hidden">
                <div class="absolute top-0 right-0 w-8 h-8 bg-green-500/10 rounded-bl-full"></div>
                <h3 class="text-[10px] sm:text-xs font-bold text-green-400 uppercase tracking-widest">Add-ons</h3>
                <p id="total-addons-summary" class="text-2xl sm:text-3xl font-bold text-white">0</p>
            </div>
        </div>

        <div id="public-info-section" class="mb-8 w-full flex flex-col gap-6">
            <div id="public-prize-section" class="w-full">
                <div class="bg-black/40 backdrop-blur rounded-xl shadow-lg p-6 border border-yellow-600/30 relative overflow-hidden">
                     <div class="absolute -top-10 -right-10 w-32 h-32 bg-yellow-500/10 rounded-full blur-2xl"></div>
                     <h2 class="text-xl font-bold text-yellow-100 uppercase tracking-widest text-center mb-6 border-b border-yellow-500/20 pb-2">Premia√ß√£o Prevista</h2>
                     <div id="public-prize-grid" class="flex flex-wrap justify-center gap-4">
                         </div>
                </div>
            </div>
            
            <div id="final-standings-section" class="w-full hidden">
                 <div class="bg-black/40 backdrop-blur rounded-xl shadow-lg p-6 border border-yellow-600/30">
                     <h2 class="text-xl font-bold text-white uppercase tracking-widest text-center mb-6 border-b border-gray-700 pb-2">üèÜ Classifica√ß√£o Final</h2>
                     <ul id="standings-list" class="space-y-3 text-center">
                         </ul>
                </div>
            </div>
        </div>

        <div id="game-controls" class="hidden animate-fade-in">
            <div class="bg-[#062e08] rounded-xl shadow-2xl overflow-hidden border border-yellow-600/30">
                <div class="table-container">
                    <table class="min-w-full divide-y divide-gray-800">
                        <thead class="bg-black text-yellow-500">
                            <tr>
                                <th class="sticky-left px-4 py-3 text-left text-xs font-bold uppercase tracking-wider shadow-md">JOGADOR</th>
                                <th class="px-2 py-3 text-center text-xs font-bold uppercase tracking-wider text-blue-400">BUY-IN</th>
                                <th colspan="10" class="px-2 py-3 text-center text-xs font-bold uppercase tracking-wider text-red-400">REBUYS</th>
                                <th class="px-2 py-3 text-center text-xs font-bold uppercase tracking-wider text-green-400">ADD-ON</th>
                                <th class="px-4 py-3 text-right text-xs font-bold uppercase tracking-wider">TOTAL</th>
                                <th class="sticky-right px-3 py-3 text-center text-xs font-bold uppercase tracking-wider shadow-md">A√á√ïES</th>
                            </tr>
                        </thead>
                        <tbody id="player-table-body" class="divide-y divide-gray-800/50">
                            </tbody>
                        <tfoot class="bg-black/80 border-t-2 border-yellow-600/50">
                            <tr>
                                <td class="sticky-left px-4 py-4 font-bold text-white text-sm bg-black/80">TOTAL GERAL</td>
                                <td id="total-buy-ins" class="px-2 py-4 text-center font-bold text-blue-400">0</td>
                                <td colspan="10" id="total-rebuys" class="px-2 py-4 text-center font-bold text-red-400">0</td>
                                <td id="total-add-ons" class="px-2 py-4 text-center font-bold text-green-400">0</td>
                                <td id="grand-total" class="px-4 py-4 text-right font-bold text-2xl text-yellow-400 whitespace-nowrap">R$ 0,00</td>
                                <td class="sticky-right bg-black/80"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <p class="text-center text-xs text-gray-500 mt-2 italic sm:hidden">Deslize para ver todas as colunas. Nomes e a√ß√µes est√£o fixos.</p>
            <div class="mt-8">
                <div id="prize-section" class="bg-black/30 backdrop-blur rounded-xl p-6 border border-gray-700 max-w-3xl mx-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-lg font-bold text-white uppercase tracking-wider flex items-center gap-2">Configurar Premia√ß√£o</h2>
                        <button id="add-prize-btn" class="bg-yellow-600 hover:bg-yellow-500 text-black font-bold h-8 w-8 rounded-full flex items-center justify-center transition-all shadow-lg text-lg leading-none" title="Adicionar Faixa de Pr√™mio">+</button>
                    </div>
                    <div id="prize-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
                    <p id="percentage-warning" class="text-center text-xs text-red-400 mt-4 hidden bg-red-900/20 p-2 rounded">A soma das porcentagens deve ser 100%.</p>
                </div>
            </div>
            <div class="mt-10 flex flex-col sm:flex-row justify-center gap-4">
                <button id="add-player-btn" class="bg-blue-700 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg border-b-4 border-blue-900 active:border-b-0 active:translate-y-1 transition-all uppercase tracking-wider flex items-center justify-center gap-2">Adicionar Jogador</button>
                <button id="reset-game-btn" class="bg-red-900/80 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg border border-red-500 transition-all uppercase tracking-wider text-sm">Resetar Jogo</button>
            </div>
        </div>
    </div>

    <div id="login-modal" class="modal-overlay fixed inset-0 bg-black/80 backdrop-blur-sm flex justify-center items-center hidden z-50">
        <div class="bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-sm border border-yellow-500/50">
            <h3 class="text-xl font-bold text-center mb-6 text-white uppercase tracking-widest">Acesso Restrito</h3>
            <form id="login-form">
                <input id="password" type="password" placeholder="Senha Admin" class="w-full bg-gray-900 text-white text-center rounded-lg p-3 mb-2 outline-none focus:ring-2 focus:ring-yellow-500 border border-gray-700 transition-all placeholder-gray-600" required>
                <p id="login-error" class="text-red-400 text-center text-xs h-5 mb-4"></p>
                <div class="flex gap-3">
                    <button id="login-cancel-btn" type="button" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded-lg uppercase text-sm">Voltar</button>
                    <button type="submit" class="flex-1 bg-yellow-600 hover:bg-yellow-500 text-black font-bold py-3 rounded-lg uppercase text-sm shadow-lg">Entrar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="confirmation-modal" class="modal-overlay fixed inset-0 bg-black/80 backdrop-blur-sm flex justify-center items-center hidden z-50">
        <div class="bg-gray-800 rounded-2xl shadow-2xl p-6 w-11/12 max-w-sm border border-gray-600">
            <p id="modal-text" class="text-center text-lg mb-8 text-gray-200"></p>
            <div class="flex justify-center gap-4">
                <button id="modal-cancel-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg uppercase tracking-wide">Cancelar</button>
                <button id="modal-confirm-btn" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-6 rounded-lg uppercase tracking-wide shadow-lg">Confirmar</button>
            </div>
        </div>
    </div>

    <div id="password-modal" class="modal-overlay fixed inset-0 bg-black/80 backdrop-blur-sm flex justify-center items-center hidden z-50">
        <div class="bg-gray-800 rounded-2xl shadow-2xl p-6 w-11/12 max-w-sm border border-red-500/50">
            <h3 class="text-lg font-bold text-center mb-2 text-red-500 uppercase">Zona de Perigo</h3>
            <p class="text-center text-sm mb-6 text-gray-400">Digite a senha para apagar todos os dados.</p>
            <input id="password-input-modal" type="password" class="w-full bg-gray-900 text-white text-center rounded-lg p-3 mb-2 outline-none focus:ring-2 focus:ring-red-500 border border-gray-700">
            <p id="password-error-modal" class="text-red-400 text-center text-xs h-4 mb-4"></p>
            <div class="flex gap-3">
                <button id="password-cancel-btn" type="button" class="flex-1 bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 rounded-lg uppercase text-sm">Cancelar</button>
                <button id="password-confirm-btn" type="button" class="flex-1 bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-lg uppercase text-sm shadow-lg">Apagar Tudo</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";

        // CONFIGURA√á√ÉO FIREBASE (MANTIDA A ORIGINAL DO USU√ÅRIO)
        const firebaseConfig = {
            apiKey: "AIzaSyA5HoMt3eYJgWZel8ka4SDdsVmvP62zj2c",
            authDomain: "pokerti-633ba.firebaseapp.com",
            projectId: "pokerti-633ba",
            storageBucket: "pokerti-633ba.firebasestorage.app",
            messagingSenderId: "883744429166",
            appId: "1:883744429166:web:7e091d7e8fcae6251c827f"
        };

        let app, db, auth;
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            signInAnonymously(auth).then(() => initializeAppLogic()).catch((e) => console.error("Login Error:", e));
        } catch (error) {
            console.error("Firebase Init Error:", error);
        }

        const initializeAppLogic = () => {
            // --- CONSTANTES ---
            const CORRECT_PASSWORD = 'poker';
            const ACTION_VALUE = 30; // Valor de cada ficha/buy-in
            const DB_COLLECTION = 'pokerGame';
            const GAME_DOC = 'gameState';
            const TIMER_DOC = 'timerState';
            const PRIZE_DOC = 'prizeConfig';
            const initialPlayers = ["DANILO", "Bronx", "Gustavo Lui", "Guilherme Lui", "Luiz", "Miudinho", "Vitor", "Lucas", "Yago", "Rodrigo Boy", "Lucas Costa", "Alexandre Costa", "Prado", "Raphinha", "NJ", "NJ2", "NJ3"];
            const initialPrizes = [50, 30, 20];
            const blindLevels = [
                { blinds: "100/100" }, { blinds: "100/200" }, { blinds: "200/400" }, { blinds: "300/600" }, 
                { blinds: "400/800" }, { blinds: "500/1000" }, { blinds: "600/1200" }, 
                { blinds: "600/1200", note: "√öltimo n√≠vel para Rebuys e Add-on" }, 
                { isBreak: true, note: "Pausa - Chip Race", duration: 15 }, 
                { blinds: "800/1600" }, { blinds: "1000/2000" }, { blinds: "1500/3000" }, 
                { blinds: "2000/4000" }, { blinds: "3000/6000" }, { blinds: "4000/8000" }, 
                { blinds: "5000/10000" }, { blinds: "6000/12000" }, { blinds: "8000/16000" }, 
                { blinds: "10000/20000" }, { blinds: "15000/30000" }, { blinds: "20000/40000" }
            ];

            // --- REFER√äNCIAS DOM ---
            const els = {
                mainContent: document.getElementById('main-content'),
                gameControls: document.getElementById('game-controls'),
                publicInfo: document.getElementById('public-info-section'),
                tableBody: document.getElementById('player-table-body'),
                timerDisplay: document.getElementById('timer-display'),
                currBlinds: document.getElementById('current-blinds'),
                nextBlinds: document.getElementById('next-blinds'),
                levelInd: document.getElementById('level-indicator'),
                note: document.getElementById('blinds-note'),
                prizeGrid: document.getElementById('prize-grid'),
                publicPrizeGrid: document.getElementById('public-prize-grid'),
                standingsList: document.getElementById('standings-list'),
                finalStandingsSection: document.getElementById('final-standings-section'),
                adminBtn: document.getElementById('admin-login-btn'),
                logoutBtn: document.getElementById('logout-btn'),
                muteBtn: document.getElementById('mute-btn'),
                toastContainer: document.getElementById('toast-container'),
                soundOn: document.getElementById('sound-on-icon'),
                soundOff: document.getElementById('sound-off-icon')
            };

            // --- ESTADO ---
            let state = {
                players: [],
                timer: { timeLeft: 900, currentLevel: 0, isRunning: false },
                isMuted: localStorage.getItem('pokerMuted') === 'true',
                updating: false,
                inputTimer: null,
                timerInterval: null
            };
            const generateId = () => Date.now().toString(36) + Math.random().toString(36).substr(2);

            // --- FUN√á√ïES AUXILIARES (TOAST E SOM) ---
            const showToast = (msg, type = 'success') => {
                const toast = document.createElement('div');
                const colors = type === 'success' ? 'bg-green-600 border-green-400' : 'bg-red-600 border-red-400';
                toast.className = `${colors} text-white px-4 py-3 rounded shadow-lg border-l-4 transform transition-all duration-300 translate-y-10 opacity-0 pointer-events-auto flex items-center gap-2`;
                toast.innerHTML = `<span class="font-bold">${type === 'success' ? '‚úì' : '!'}</span> ${msg}`;
                els.toastContainer.appendChild(toast);
                requestAnimationFrame(() => toast.classList.remove('translate-y-10', 'opacity-0'));
                setTimeout(() => {
                    toast.classList.add('opacity-0', 'translate-x-10');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            };

            const speak = (text) => {
                if (state.isMuted || !window.speechSynthesis) return;
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'pt-BR';
                u.rate = 1.1;
                window.speechSynthesis.speak(u);
            };

            const playSound = (type) => {
                if (state.isMuted) return;
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                if (!ctx) return;
                const o = ctx.createOscillator();
                const g = ctx.createGain();
                o.connect(g); g.connect(ctx.destination);
                
                if (type === 'beep') {
                    o.type = 'sine'; o.frequency.setValueAtTime(880, ctx.currentTime);
                    g.gain.setValueAtTime(0.1, ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.1);
                    o.start(); o.stop(ctx.currentTime + 0.1);
                } else if (type === 'level') {
                    o.type = 'triangle'; o.frequency.setValueAtTime(440, ctx.currentTime);
                    o.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.3);
                    g.gain.setValueAtTime(0.2, ctx.currentTime); g.gain.linearRampToValueAtTime(0, ctx.currentTime + 1);
                    o.start(); o.stop(ctx.currentTime + 1);
                }
            };

            // --- L√ìGICA DO TIMER ---
            const updateTimerUI = () => {
                const m = Math.floor(state.timer.timeLeft / 60).toString().padStart(2, '0');
                const s = (state.timer.timeLeft % 60).toString().padStart(2, '0');
                els.timerDisplay.textContent = `${m}:${s}`;
                
                const lvl = blindLevels[state.timer.currentLevel];
                if (lvl?.isBreak) {
                    els.currBlinds.textContent = "PAUSA";
                    els.currBlinds.className = "text-3xl sm:text-4xl font-bold text-green-400 tracking-tighter animate-pulse";
                } else {
                    els.currBlinds.textContent = lvl?.blinds || 'FIM';
                    els.currBlinds.className = "text-3xl sm:text-4xl font-bold text-white tracking-tighter";
                }
                
                els.note.textContent = lvl?.note || '';
                const next = blindLevels.find((l, i) => i > state.timer.currentLevel && !l.isBreak);
                els.nextBlinds.textContent = next?.blinds || '---';
                els.levelInd.textContent = `N√≠vel ${state.timer.currentLevel + 1}`;
                
                document.body.classList.toggle('rebuys-disabled', state.timer.currentLevel >= 8);
                
                const btn = document.getElementById('timer-control-btn');
                btn.textContent = state.timer.isRunning ? 'PAUSAR' : 'INICIAR';
                btn.className = state.timer.isRunning 
                    ? "flex-1 sm:flex-none bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-2 px-6 rounded shadow border-b-4 border-yellow-800 active:border-b-0 active:translate-y-1 transition-all uppercase text-sm tracking-wide"
                    : "flex-1 sm:flex-none bg-green-700 hover:bg-green-600 text-white font-bold py-2 px-6 rounded shadow border-b-4 border-green-900 active:border-b-0 active:translate-y-1 transition-all uppercase text-sm tracking-wide";
            };

            const runTimer = () => {
                if (state.timer.timeLeft > 0) {
                    state.timer.timeLeft--;
                    updateTimerUI();
                    if (state.timer.timeLeft <= 10 && state.timer.timeLeft > 0) playSound('beep');
                } else {
                    clearInterval(state.timerInterval);
                    nextLevel();
                }
            };

            const saveTimer = async () => {
                await setDoc(doc(db, DB_COLLECTION, TIMER_DOC), {
                    ...state.timer,
                    lastUpdateTime: state.timer.isRunning ? serverTimestamp() : null
                }, { merge: true });
            };

            const nextLevel = () => {
                const oldLvl = state.timer.currentLevel;
                if (oldLvl < blindLevels.length - 1) {
                    const newLvlIdx = oldLvl + 1;
                    const newLvl = blindLevels[newLvlIdx];
                    state.timer.currentLevel = newLvlIdx;
                    state.timer.timeLeft = (newLvl.isBreak ? newLvl.duration : parseInt(document.getElementById('level-duration').value)) * 60;
                    playSound('level');
                    if (newLvl.isBreak) speak("Aten√ß√£o jogadores. Pausa de 15 minutos.");
                    else speak(`Os blinds subiram. N√≠vel ${newLvlIdx + 1}. ${newLvl.blinds.replace('/', ' ')}.`);
                    saveTimer();
                } else {
                    state.timer.isRunning = false;
                    saveTimer();
                }
            };

            // --- L√ìGICA DO JOGO ---
            const renderTable = () => {
                els.tableBody.innerHTML = '';
                // const active = state.players.filter(p => !p.eliminated);
                const eliminated = state.players.filter(p => p.eliminated)
                    .sort((a, b) => (a.eliminationTimestamp?.toMillis() || 0) - (b.eliminationTimestamp?.toMillis() || 0));
                
                const rankMap = new Map();
                eliminated.forEach((p, i) => rankMap.set(p.id, state.players.length - i));
                
                [...state.players].forEach(p => {
                     const tr = document.createElement('tr');
                     const isEliminated = p.eliminated;
                     tr.className = `player-row hover:bg-yellow-400/5 transition-colors ${isEliminated ? 'eliminated' : ''}`;
                     tr.dataset.id = p.id;
                     
                     const rankHtml = isEliminated && rankMap.get(p.id) ? `<span class="elimination-rank">${rankMap.get(p.id)}¬∫</span>` : '';
                     
                     let rebuysHtml = '';
                     for(let i=0; i<10; i++) {
                         rebuysHtml += `<td class="p-1 text-center"><label class="chip-label"><input type="checkbox" class="chip-checkbox rebuy-cb" ${p.rebuysChecked?.[i] ? 'checked' : ''}><span class="chip"></span></label></td>`;
                     }

                     tr.innerHTML = `
                        <td class="sticky-left px-4 py-3 whitespace-nowrap bg-[#062e08]">
                            <div class="flex items-center">
                                ${rankHtml}
                                <input type="text" value="${p.name}" class="player-name bg-transparent text-gray-200 font-medium w-full outline-none focus:text-yellow-400 border-b border-transparent focus:border-yellow-500 transition-all uppercase" ${isEliminated ? 'disabled' : ''}>
                            </div>
                        </td>
                        <td class="p-1 text-center"><label class="chip-label"><input type="checkbox" class="chip-checkbox buy-in-cb" ${p.buyInChecked ? 'checked' : ''}><span class="chip"></span></label></td>
                        ${rebuysHtml}
                        <td class="p-1 text-center"><label class="chip-label"><input type="checkbox" class="chip-checkbox add-on-cb" ${p.addOnChecked ? 'checked' : ''}><span class="chip"></span></label></td>
                        <td class="player-total px-4 py-3 text-right font-mono font-medium text-gray-400">R$ 0,00</td>
                        <td class="sticky-right px-2 py-3 text-center bg-[#062e08]">
                            <div class="flex items-center justify-center gap-2">
                                <button class="eliminate-player-btn text-gray-500 hover:text-yellow-500 transition-colors" title="${isEliminated ? 'Restaurar' : 'Eliminar'}">
                                    <svg class="pointer-events-none" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M11 1a1 1 0 0 1 1 1v2a1 1 0 0 1-2 0V2a1 1 0 0 1 1-1zM5 1a1 1 0 0 1 1 1v2a1 1 0 0 1-2 0V2a1 1 0 0 1 1-1zm6 8a1 1 0 0 1 1 1v2a1 1 0 0 1-2 0v-2a1 1 0 0 1 1-1zM5 9a1 1 0 0 1 1 1v2a1 1 0 0 1-2 0v-2a1 1 0 0 1 1-1z"/><path d="M8 0a.5.5 0 0 1 .5.5V3h3a.5.5 0 0 1 0 1h-3v2.03a1.5 1.5 0 0 1-2 0V4H3.5a.5.5 0 0 1 0-1H6V.5A.5.5 0 0 1 6.5 0h3A.5.5 0 0 1 8 0zM2 4.5A1.5 1.5 0 0 1 3.5 6H4a.5.5 0 0 1 0 1H3.5A1.5 1.5 0 0 1 2 5.5v-1A1.5 1.5 0 0 1 3.5 3H4a.5.5 0 0 1 0-1H3.5A1.5 1.5 0 0 1 2 3.5v1zM12.5 6A1.5 1.5 0 0 1 14 4.5v-1A1.5 1.5 0 0 1 12.5 2H12a.5.5 0 0 1 0-1h.5A1.5 1.5 0 0 1 14 2.5v1A1.5 1.5 0 0 1 12.5 5H12a.5.5 0 0 1 0 1h.5zM12.5 12A1.5 1.5 0 0 1 14 10.5v-1A1.5 1.5 0 0 1 12.5 8H12a.5.5 0 0 1 0-1h.5A1.5 1.5 0 0 1 14 8.5v1A1.5 1.5 0 0 1 12.5 11H12a.5.5 0 0 1 0 1h.5zM2 10.5A1.5 1.5 0 0 1 3.5 12H4a.5.5 0 0 1 0 1H3.5A1.5 1.5 0 0 1 2 11.5v-1A1.5 1.5 0 0 1 3.5 9H4a.5.5 0 0 1 0-1H3.5A1.5 1.5 0 0 1 2 9.5v1z"/></svg>
                                </button>
                                <button class="delete-player-btn text-gray-500 hover:text-red-500 transition-colors" title="Excluir Definitivamente">
                                    <svg class="pointer-events-none" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"/></svg>
                                </button>
                            </div>
                        </td>`;
                     els.tableBody.appendChild(tr);
                });
                calculateTotals();
            };

            const calculateTotals = () => {
                let gTotal = 0, nBuy = 0, nRebuy = 0, nAddon = 0;
                
                state.players.forEach(p => {
                    let pTotal = 0;
                    if(p.buyInChecked) { gTotal += ACTION_VALUE; pTotal += ACTION_VALUE; nBuy++; }
                    if(p.addOnChecked) { gTotal += ACTION_VALUE; pTotal += ACTION_VALUE; nAddon++; }
                    const rCount = p.rebuysChecked.filter(Boolean).length;
                    gTotal += rCount * ACTION_VALUE; pTotal += rCount * ACTION_VALUE; nRebuy += rCount;
                    
                    const row = document.querySelector(`.player-row[data-id="${p.id}"] .player-total`);
                    if(row) {
                        row.textContent = `R$ ${pTotal.toFixed(2)}`;
                        row.classList.toggle('text-yellow-400', pTotal > 0);
                        row.classList.toggle('text-gray-400', pTotal === 0);
                    }
                });

                document.getElementById('total-buy-ins').textContent = nBuy;
                document.getElementById('total-rebuys').textContent = nRebuy;
                document.getElementById('total-add-ons').textContent = nAddon;
                document.getElementById('grand-total').textContent = `R$ ${gTotal.toFixed(2)}`;
                
                document.getElementById('total-players-summary').textContent = state.players.filter(p=>!p.eliminated).length;
                document.getElementById('total-buyins-summary').textContent = nBuy;
                document.getElementById('total-rebuys-summary').textContent = nRebuy;
                document.getElementById('total-addons-summary').textContent = nAddon;

                renderPrizes(gTotal);
                renderStandings();
            };

            const renderPrizes = (total) => {
                const inputs = document.querySelectorAll('.prize-percent-input');
                const percentages = Array.from(inputs).map(i => parseFloat(i.value)||0);
                
                document.querySelectorAll('.prize-item').forEach((div, i) => {
                   div.querySelector('.prize-val').textContent = `R$ ${((total * percentages[i])/100).toFixed(2)}`; 
                });

                els.publicPrizeGrid.innerHTML = '';
                percentages.forEach((pct, i) => {
                    if(pct <= 0) return;
                    const val = ((total * pct)/100).toFixed(2);
                    const color = i === 0 ? 'text-yellow-400' : i === 1 ? 'text-gray-300' : 'text-amber-600';
                    els.publicPrizeGrid.innerHTML += `
                        <div class="bg-black/30 p-4 rounded border border-gray-700 flex-1 min-w-[200px] max-w-[300px] text-center">
                            <p class="text-xs text-gray-400 uppercase tracking-widest">${i+1}¬∫ LUGAR</p>
                            <p class="text-3xl font-bold ${color} mt-2">R$ ${val}</p>
                            <p class="text-xs text-gray-600 mt-1">${pct}%</p>
                        </div>
                    `;
                });
            };

            const renderStandings = () => {
                const eliminated = state.players.filter(p => p.eliminated && p.eliminationTimestamp)
                    .sort((a, b) => b.eliminationTimestamp.toMillis() - a.eliminationTimestamp.toMillis());
                
                if(eliminated.length > 0) {
                    els.finalStandingsSection.classList.remove('hidden');
                    els.standingsList.innerHTML = '';
                    const totalP = state.players.length;
                    eliminated.sort((a, b) => a.eliminationTimestamp.toMillis() - b.eliminationTimestamp.toMillis());
                    
                    eliminated.forEach((p, i) => {
                        const rank = totalP - i;
                        els.standingsList.innerHTML += `<li class="text-gray-300 flex justify-center items-center gap-2 text-lg"><span class="font-bold text-yellow-600 text-xl">${rank}¬∫</span> ${p.name}</li>`;
                    });
                } else {
                    els.finalStandingsSection.classList.add('hidden');
                }
            };

            const saveGame = async () => {
                if(state.updating) return;
                try {
                    await setDoc(doc(db, DB_COLLECTION, GAME_DOC), { players: state.players });
                } catch(e) { console.error(e); showToast('Erro ao salvar!', 'error'); }
            };

            els.tableBody.addEventListener('input', (e) => {
                const tr = e.target.closest('tr');
                if(!tr) return;
                const p = state.players.find(x => x.id === tr.dataset.id);
                if(!p) return;
                if(e.target.matches('.player-name')) p.name = e.target.value;
                if(e.target.matches('.buy-in-cb')) p.buyInChecked = e.target.checked;
                if(e.target.matches('.add-on-cb')) p.addOnChecked = e.target.checked;
                if(e.target.matches('.rebuy-cb')) {
                    const idx = Array.from(tr.querySelectorAll('.rebuy-cb')).indexOf(e.target);
                    p.rebuysChecked[idx] = e.target.checked;
                }
                clearTimeout(state.inputTimer);
                state.inputTimer = setTimeout(saveGame, 500);
                calculateTotals();
            });

            els.tableBody.addEventListener('click', (e) => {
                 const tr = e.target.closest('tr');
                 if(!tr) return;
                 const idx = state.players.findIndex(x => x.id === tr.dataset.id);
                 if(idx === -1) return;
                 if(e.target.closest('.delete-player-btn')) {
                     if(confirm(`Remover ${state.players[idx].name}?`)) {
                         state.players.splice(idx, 1);
                         saveGame();
                         showToast('Jogador removido');
                     }
                 } else if (e.target.closest('.eliminate-player-btn')) {
                     const p = state.players[idx];
                     p.eliminated = !p.eliminated;
                     p.eliminationTimestamp = p.eliminated ? serverTimestamp() : null;
                     saveGame();
                     showToast(p.eliminated ? `${p.name} eliminado!` : `${p.name} voltou ao jogo!`);
                 }
            });

            document.getElementById('timer-control-btn').addEventListener('click', () => {
                state.timer.isRunning = !state.timer.isRunning;
                saveTimer();
            });
            document.getElementById('reset-timer-btn').addEventListener('click', () => {
                state.timer.isRunning = false;
                state.timer.timeLeft = parseInt(document.getElementById('level-duration').value) * 60;
                state.timer.currentLevel = 0;
                saveTimer();
                showToast('Timer resetado');
            });
            document.getElementById('prev-level-btn').addEventListener('click', () => {
                 if(state.timer.currentLevel > 0) { 
                     state.timer.currentLevel--; 
                     state.timer.timeLeft = parseInt(document.getElementById('level-duration').value) * 60;
                     saveTimer(); 
                 }
            });
            document.getElementById('next-level-btn').addEventListener('click', () => {
                 if(state.timer.currentLevel < blindLevels.length-1) {
                     state.timer.currentLevel++;
                     state.timer.timeLeft = parseInt(document.getElementById('level-duration').value) * 60;
                     saveTimer();
                 }
            });

            els.adminBtn.addEventListener('click', () => document.getElementById('login-modal').classList.remove('hidden'));
            document.getElementById('login-cancel-btn').addEventListener('click', () => document.getElementById('login-modal').classList.add('hidden'));
            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const pwd = document.getElementById('password');
                if(pwd.value === CORRECT_PASSWORD) {
                    sessionStorage.setItem('pokerAdmin', 'true');
                    updateAuthUI();
                    document.getElementById('login-modal').classList.add('hidden');
                    pwd.value = '';
                    showToast('Modo Admin Ativo');
                } else {
                    document.getElementById('login-error').textContent = 'Senha incorreta';
                }
            });
            els.logoutBtn.addEventListener('click', () => {
                sessionStorage.removeItem('pokerAdmin');
                updateAuthUI();
                showToast('Logout realizado');
            });

            const updateAuthUI = () => {
                const isAdmin = sessionStorage.getItem('pokerAdmin') === 'true';
                if(isAdmin) {
                    els.gameControls.classList.remove('hidden');
                    els.publicInfo.classList.add('hidden');
                    els.adminBtn.classList.add('hidden');
                    els.logoutBtn.classList.remove('hidden');
                } else {
                    els.gameControls.classList.add('hidden');
                    els.publicInfo.classList.remove('hidden');
                    els.adminBtn.classList.remove('hidden');
                    els.logoutBtn.classList.add('hidden');
                }
            };
            
            document.getElementById('add-player-btn').addEventListener('click', () => {
                state.players.push({
                    id: generateId(), name: '', buyInChecked: false, rebuysChecked: Array(10).fill(false),
                    addOnChecked: false, eliminated: false, eliminationTimestamp: null
                });
                saveGame();
                showToast('Novo jogador adicionado');
            });

            document.getElementById('add-prize-btn').addEventListener('click', async () => {
                const inputs = document.querySelectorAll('.prize-percent-input');
                const p = Array.from(inputs).map(i => parseFloat(i.value)||0);
                p.push(0);
                await setDoc(doc(db, DB_COLLECTION, PRIZE_DOC), { percentages: p });
            });

            els.prizeGrid.addEventListener('click', async (e) => {
                if(e.target.closest('.remove-prize')) {
                    const row = e.target.closest('.prize-item');
                    const inputs = document.querySelectorAll('.prize-percent-input');
                    const allP = Array.from(inputs).map(i => parseFloat(i.value)||0);
                    const idx = Array.from(document.querySelectorAll('.prize-item')).indexOf(row);
                    allP.splice(idx, 1);
                    await setDoc(doc(db, DB_COLLECTION, PRIZE_DOC), { percentages: allP });
                }
            });
            els.prizeGrid.addEventListener('input', (e) => {
                if(e.target.matches('.prize-percent-input')) {
                    const inputs = document.querySelectorAll('.prize-percent-input');
                    const p = Array.from(inputs).map(i => parseFloat(i.value)||0);
                    clearTimeout(state.inputTimer);
                    state.inputTimer = setTimeout(async () => {
                        await setDoc(doc(db, DB_COLLECTION, PRIZE_DOC), { percentages: p });
                    }, 800);
                    calculateTotals();
                }
            });

            els.muteBtn.addEventListener('click', () => {
                state.isMuted = !state.isMuted;
                localStorage.setItem('pokerMuted', state.isMuted);
                els.soundOn.classList.toggle('hidden', state.isMuted);
                els.soundOff.classList.toggle('hidden', !state.isMuted);
                showToast(state.isMuted ? 'Som desativado' : 'Som ativado');
            });

            document.getElementById('reset-game-btn').addEventListener('click', () => document.getElementById('password-modal').classList.remove('hidden'));
            document.getElementById('password-cancel-btn').addEventListener('click', () => document.getElementById('password-modal').classList.add('hidden'));
            document.getElementById('password-confirm-btn').addEventListener('click', async () => {
                const val = document.getElementById('password-input-modal').value;
                if(val === CORRECT_PASSWORD) {
                    document.getElementById('password-modal').classList.add('hidden');
                    document.getElementById('password-input-modal').value = '';
                    const players = initialPlayers.map(name => ({
                        id: generateId(), name, buyInChecked: false, rebuysChecked: Array(10).fill(false),
                        addOnChecked: false, eliminated: false, eliminationTimestamp: null
                    }));
                    await setDoc(doc(db, DB_COLLECTION, GAME_DOC), { players });
                    await setDoc(doc(db, DB_COLLECTION, TIMER_DOC), { timeLeft: 900, currentLevel: 0, isRunning: false });
                    await setDoc(doc(db, DB_COLLECTION, PRIZE_DOC), { percentages: initialPrizes });
                    showToast('Jogo Reiniciado!', 'success');
                } else {
                    document.getElementById('password-error-modal').textContent = 'Senha incorreta';
                }
            });

            onSnapshot(doc(db, DB_COLLECTION, GAME_DOC), (snap) => {
                state.updating = true;
                if(snap.exists()) state.players = snap.data().players || [];
                else state.players = [];
                renderTable();
                state.updating = false;
            });

            onSnapshot(doc(db, DB_COLLECTION, TIMER_DOC), (snap) => {
                if(snap.exists()) {
                    const d = snap.data();
                    state.timer = { ...state.timer, ...d };
                    if(state.timer.isRunning) {
                        const elapsed = d.lastUpdateTime ? Math.floor((Date.now() - d.lastUpdateTime.toMillis()) / 1000) : 0;
                        state.timer.timeLeft = Math.max(0, state.timer.timeLeft - elapsed);
                        if(!state.timerInterval) state.timerInterval = setInterval(runTimer, 1000);
                    } else {
                        clearInterval(state.timerInterval);
                        state.timerInterval = null;
                    }
                    updateTimerUI();
                }
            });

            onSnapshot(doc(db, DB_COLLECTION, PRIZE_DOC), (snap) => {
                 const pct = snap.exists() ? snap.data().percentages : initialPrizes;
                 els.prizeGrid.innerHTML = '';
                 pct.forEach((val, i) => {
                     const div = document.createElement('div');
                     div.className = 'prize-item relative bg-black/20 p-3 rounded border border-gray-600';
                     div.innerHTML = `
                        <label class="text-xs text-yellow-500 font-bold uppercase block mb-1">${i+1}¬∫ Lugar</label>
                        <div class="flex items-center gap-2">
                            <input type="number" class="prize-percent-input w-16 bg-gray-800 text-white p-1 text-center rounded outline-none focus:ring-1 focus:ring-yellow-500" value="${val}">
                            <span class="text-gray-400">%</span>
                        </div>
                        <p class="prize-val mt-2 text-lg font-bold text-white">R$ 0.00</p>
                        ${i > 2 ? `<button class="remove-prize absolute top-1 right-1 text-red-400 hover:text-red-300 text-xl font-bold px-2">&times;</button>` : ''}
                     `;
                     els.prizeGrid.appendChild(div);
                 });
                 calculateTotals();
            });

            els.soundOn.classList.toggle('hidden', state.isMuted);
            els.soundOff.classList.toggle('hidden', !state.isMuted);
            updateAuthUI();
        };
    </script>
</body>
</html>
